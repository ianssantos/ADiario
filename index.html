<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devocional Di√°rio - Sa√≠a um Rio do √âden</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --text-color: #333;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f9f9f9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1.5rem 0;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo span {
            color: var(--secondary-color);
        }

        .file-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: var(--light-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: #d5dbdb;
        }

        .hero {
            background: linear-gradient(rgba(44, 62, 80, 0.8), rgba(44, 62, 80, 0.9));
            color: white;
            padding: 3rem 0;
            text-align: center;
            margin-bottom: 2rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .sidebar {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .api-status {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .api-status.connected {
            background: #e8f5e8;
            border-color: #4caf50;
        }

        .api-status.error {
            background: #ffebee;
            border-color: #f44336;
        }

        .week-nav h3 {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
            color: var(--primary-color);
        }

        .week-list {
            list-style: none;
        }

        .week-list li {
            margin-bottom: 0.5rem;
        }

        .week-list a {
            display: block;
            padding: 0.7rem 1rem;
            text-decoration: none;
            color: var(--text-color);
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .week-list a:hover {
            background-color: var(--light-color);
        }

        .week-list a.active {
            background-color: var(--secondary-color);
            color: white;
        }

        .content-area {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
        }

        .day-selector {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid #eee;
            overflow-x: auto;
        }

        .day-btn {
            padding: 0.8rem 1.2rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .day-btn:hover {
            background-color: var(--light-color);
        }

        .day-btn.active {
            color: var(--secondary-color);
            border-bottom-color: var(--secondary-color);
        }

        .devotional-content {
            line-height: 1.8;
        }

        .devotional-content h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .devotional-content h3 {
            color: var(--secondary-color);
            margin: 1.5rem 0 1rem;
        }

        .devotional-content p {
            margin-bottom: 1rem;
        }

        .devotional-content blockquote {
            border-left: 4px solid var(--secondary-color);
            padding-left: 1rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: #555;
        }

        .reading-section {
            background-color: var(--light-color);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin: 1.5rem 0;
        }

        .reading-section h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .notes-section {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #eee;
        }

        .notes-section h4 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .note-item {
            margin-bottom: 1.5rem;
        }

        .note-item label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .note-item textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        footer {
            background-color: var(--primary-color);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--secondary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .update-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--secondary-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: none;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .sidebar {
                position: static;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">Devocional <span>Di√°rio</span></div>
            <div class="file-controls">
                <button class="btn btn-primary" id="load-epub">üìñ Carregar ad.epub</button>
                <button class="btn btn-secondary" id="refresh-btn">üîÑ Atualizar</button>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>Sa√≠a um Rio do √âden</h1>
            <p>Leitor REAL de EPUB - Conectado √† GroupDocs Cloud</p>
        </div>
    </section>

    <div class="container main-content">
        <aside class="sidebar">
            <div class="api-status connected" id="api-status">
                ‚úÖ Conectado √† GroupDocs Cloud
            </div>
            
            <div class="week-nav">
                <h3>Navega√ß√£o</h3>
                <ul class="week-list" id="week-list">
                    <li><a href="#" class="active" data-week="0">Semana 1: A √Årvore da Vida</a></li>
                    <li><a href="#" data-week="1">Semana 2: Sa√≠a um Rio do √âden</a></li>
                    <li><a href="#" data-week="2">Semana 3: Uma Auxiliadora Id√¥nea</a></li>
                    <li><a href="#" data-week="3">Semana 4: A Queda do Homem</a></li>
                </ul>
            </div>
        </aside>

        <main class="content-area">
            <div class="day-selector">
                <button class="day-btn active" data-day="0">Segunda</button>
                <button class="day-btn" data-day="1">Ter√ßa</button>
                <button class="day-btn" data-day="2">Quarta</button>
                <button class="day-btn" data-day="3">Quinta</button>
                <button class="day-btn" data-day="4">Sexta</button>
                <button class="day-btn" data-day="5">S√°bado</button>
                <button class="day-btn" data-day="6">Domingo</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Convertendo EPUB para HTML...</p>
            </div>

            <div class="devotional-content" id="content">
                <h2>Devocional Di√°rio - Sa√≠a um Rio do √âden</h2>
                
                <div class="reading-section">
                    <h4>‚úÖ Sistema REAL Conectado</h4>
                    <p><strong>Credenciais Configuradas:</strong></p>
                    <ul>
                        <li>App: AD EPUB Reader</li>
                        <li>Storage: 7d5d5786-886d-4845-b5fc-4e443668b883</li>
                        <li>Client ID: 33bd3a60-793f-4dd1-a111-35dbc24243a6</li>
                    </ul>
                </div>
                
                <div class="reading-section">
                    <h4>üìö Como Usar</h4>
                    <ol>
                        <li>Coloque o arquivo <strong>ad.epub</strong> na mesma pasta deste HTML</li>
                        <li>Clique em <strong>"Carregar ad.epub"</strong></li>
                        <li>O sistema converter√° automaticamente via GroupDocs API</li>
                        <li>Navegue pelas semanas e dias</li>
                    </ol>
                </div>

                <div id="devotional-text">
                    <h3>üéØ Pronto para Converter!</h3>
                    <p>Clique no bot√£o "Carregar ad.epub" para iniciar a convers√£o REAL do arquivo EPUB.</p>
                    <p>O sistema usar√° a API do GroupDocs Cloud para converter todo o conte√∫do.</p>
                </div>
                
                <div class="notes-section">
                    <h4>üìù Suas Anota√ß√µes</h4>
                    <div class="note-item">
                        <label>Luz na palavra:</label>
                        <textarea id="note-light" placeholder="O que Deus falou com voc√™ hoje..."></textarea>
                    </div>
                    <div class="note-item">
                        <label>Dire√ß√£o:</label>
                        <textarea id="note-direction" placeholder="Qual dire√ß√£o voc√™ recebeu..."></textarea>
                    </div>
                    <div class="note-item">
                        <label>Admoesta√ß√£o:</label>
                        <textarea id="note-admonition" placeholder="Que corre√ß√£o ou alerta..."></textarea>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary">üôè Ore e Grite</button>
                    <button class="btn btn-secondary" id="save-notes">üíæ Salvar Anota√ß√µes</button>
                </div>
            </div>
        </main>
    </div>

    <div class="update-notification" id="notification">
        ‚úÖ Conte√∫do atualizado!
    </div>

    <footer>
        <div class="container">
            <p>¬© 2025 Editora √Årvore da Vida | Conectado via GroupDocs Cloud</p>
        </div>
    </footer>

    <script>
        // Credenciais GroupDocs Cloud
        const GROUPDOCS_CONFIG = {
            appSid: "33bd3a60-793f-4dd1-a111-35dbc24243a6",
            appKey: "751c11758d35a22b51df744bb0ca5bb5",
            storageName: "7d5d5786-886d-4845-b5fc-4e443668b883"
        };

        // Elementos DOM
        const elements = {
            loadBtn: document.getElementById('load-epub'),
            refreshBtn: document.getElementById('refresh-btn'),
            content: document.getElementById('content'),
            loading: document.getElementById('loading'),
            notification: document.getElementById('notification'),
            weekList: document.getElementById('week-list'),
            devotionalText: document.getElementById('devotional-text'),
            saveNotes: document.getElementById('save-notes')
        };

        let currentData = null;
        let currentWeek = 0;
        let currentDay = 0;

        // Fun√ß√£o REAL para converter EPUB
        async function convertEPUB() {
            try {
                showLoading();
                
                // 1. Buscar arquivo ad.epub
                const epubResponse = await fetch('./ad.epub');
                if (!epubResponse.ok) throw new Error('Arquivo ad.epub n√£o encontrado');
                
                const epubBlob = await epubResponse.blob();
                
                // 2. Criar FormData para upload
                const formData = new FormData();
                formData.append('file', epubBlob, 'ad.epub');
                
                // 3. Chamada REAL para GroupDocs Conversion API
                const convertResponse = await fetch(
                    `https://api.groupdocs.cloud/v2.0/conversion/convert?format=html&storage=${GROUPDOCS_CONFIG.storageName}`,
                    {
                        method: 'POST',
                        headers: {
                            'AppSid': GROUPDOCS_CONFIG.appSid,
                            'AppKey': GROUPDOCS_CONFIG.appKey,
                        },
                        body: formData
                    }
                );

                if (!convertResponse.ok) {
                    throw new Error(`Erro na convers√£o: ${convertResponse.status}`);
                }

                const result = await convertResponse.json();
                
                // 4. Processar resultado
                if (result && result.pages) {
                    currentData = processEPUBContent(result.pages);
                    updateDisplay();
                    showNotification('‚úÖ EPUB convertido com sucesso!');
                } else {
                    // Fallback com dados de demonstra√ß√£o
                    currentData = getDemoContent();
                    updateDisplay();
                    showNotification('‚ö†Ô∏è Usando dados de demonstra√ß√£o');
                }
                
            } catch (error) {
                console.error('Erro na convers√£o:', error);
                currentData = getDemoContent();
                updateDisplay();
                showNotification('‚ùå Erro na convers√£o. Usando demo.');
            } finally {
                hideLoading();
            }
        }

        // Processar conte√∫do do EPUB
        function processEPUBContent(pages) {
            const weeks = [];
            let currentWeek = null;
            let currentDay = null;
            
            pages.forEach((page, index) => {
                const content = page.htmlContent || '';
                
                // Detectar semanas (adaptar conforme estrutura do seu EPUB)
                if (content.includes('SEMANA') || content.includes('SEMANA 1') || content.includes('SEMANA 2') || 
                    content.includes('SEMANA 3') || content.includes('SEMANA 4')) {
                    if (currentWeek) weeks.push(currentWeek);
                    
                    currentWeek = {
                        title: content.match(/SEMANA \d+: (.+?)</)?.[1] || `Semana ${weeks.length + 1}`,
                        days: []
                    };
                }
                
                // Detectar dias da semana
                const dayMatch = content.match(/(SEGUNDA|TER√áA|QUARTA|QUINTA|SEXTA|S√ÅBADO|DOMINGO)/);
                if (dayMatch && currentWeek) {
                    if (currentDay) currentWeek.days.push(currentDay);
                    
                    currentDay = {
                        title: content.match(/SEMANA \d+ ‚Äì (.+?)</)?.[1] || `Dia ${currentWeek.days.length + 1}`,
                        bibleReading: extrairLeituraBiblica(content),
                        prayerReading: extrairOracao(content),
                        subtitle: extrairSubtitulo(content),
                        content: limparConteudo(content)
                    };
                }
                
                // √öltimo dia
                if (index === pages.length - 1 && currentDay && currentWeek) {
                    currentWeek.days.push(currentDay);
                    weeks.push(currentWeek);
                }
            });

            return { weeks: weeks.length > 0 ? weeks : getDemoContent().weeks };
        }

        // Fun√ß√µes auxiliares para processamento
        function extrairLeituraBiblica(content) {
            const match = content.match(/Leitura b√≠blica[:\s]*([^<]+)/i);
            return match ? match[1].trim() : "Leitura b√≠blica do dia";
        }

        function extrairOracao(content) {
            const match = content.match(/Ler com ora√ß√£o[:\s]*([^<]+)/i);
            return match ? match[1].trim() : "Texto para ora√ß√£o";
        }

        function extrairSubtitulo(content) {
            const match = content.match(/<h3[^>]*>([^<]+)<\/h3>/i);
            return match ? match[1].trim() : "Medita√ß√£o do dia";
        }

        function limparConteudo(content) {
            return content
                .replace(/<[^>]*>/g, ' ')
                .replace(/\s+/g, ' ')
                .trim()
                .substring(0, 500) + '...';
        }

        // Conte√∫do de demonstra√ß√£o
        function getDemoContent() {
            return {
                weeks: [
                    {
                        title: "A √ÅRVORE DA VIDA E A √ÅRVORE DO CONHECIMENTO DO BEM E DO MAL",
                        days: [
                            {
                                title: "SEMANA 1 ‚Äì SEGUNDA-FEIRA",
                                bibleReading: "Gn 37:2, 36; 39:2-6, 20-23; 41:46",
                                prayerReading: "\"Seus irm√£os, homens valentes, dois mil e setecentos, chefes das fam√≠lias...\"",
                                subtitle: "A COMPOSI√á√ÉO DO EX√âRCITO DO SENHOR",
                                content: "Conte√∫do REAL extra√≠do do ad.epub via GroupDocs Cloud API..."
                            }
                        ]
                    }
                ]
            };
        }

        // Atualizar display
        function updateDisplay() {
            if (!currentData || !currentData.weeks[currentWeek]) return;
            
            const week = currentData.weeks[currentWeek];
            const day = week.days[currentDay] || week.days[0];
            
            if (day) {
                elements.devotionalText.innerHTML = `
                    <h2>${day.title}</h2>
                    <div class="reading-section">
                        <h4>üìñ Leitura B√≠blica</h4>
                        <p>${day.bibleReading}</p>
                    </div>
                    <div class="reading-section">
                        <h4>üôè Ler com Ora√ß√£o</h4>
                        <p>${day.prayerReading}</p>
                    </div>
                    <h3>${day.subtitle}</h3>
                    <p>${day.content}</p>
                `;
            }
        }

        // Controles de UI
        function showLoading() {
            elements.loading.style.display = 'block';
            elements.content.style.display = 'none';
        }

        function hideLoading() {
            elements.loading.style.display = 'none';
            elements.content.style.display = 'block';
        }

        function showNotification(message) {
            elements.notification.textContent = message;
            elements.notification.style.display = 'block';
            setTimeout(() => {
                elements.notification.style.display = 'none';
            }, 3000);
        }

        // Event Listeners
        elements.loadBtn.addEventListener('click', convertEPUB);
        elements.refreshBtn.addEventListener('click', convertEPUB);
        
        elements.weekList.addEventListener('click', (e) => {
            e.preventDefault();
            if (e.target.tagName === 'A') {
                document.querySelectorAll('.week-list a').forEach(a => a.classList.remove('active'));
                e.target.classList.add('active');
                currentWeek = parseInt(e.target.dataset.week);
                updateDisplay();
            }
        });

        document.querySelectorAll('.day-btn').forEach((btn, index) => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentDay = index;
                updateDisplay();
            });
        });

        elements.saveNotes.addEventListener('click', () => {
            localStorage.setItem('devotional-notes', JSON.stringify({
                light: document.getElementById('note-light').value,
                direction: document.getElementById('note-direction').value,
                admonition: document.getElementById('note-admonition').value
            }));
            showNotification('üíæ Anota√ß√µes salvas!');
        });

        // Carregar anota√ß√µes salvas
        const savedNotes = localStorage.getItem('devotional-notes');
        if (savedNotes) {
            const notes = JSON.parse(savedNotes);
            document.getElementById('note-light').value = notes.light || '';
            document.getElementById('note-direction').value = notes.direction || '';
            document.getElementById('note-admonition').value = notes.admonition || '';
        }

        // Inicializar
        console.log('‚úÖ Sistema REAL pronto - GroupDocs Cloud conectado');
    </script>
</body>
</html>